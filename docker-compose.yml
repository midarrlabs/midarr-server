services:

  midarr:
    container_name: midarr
    build: .
    ports:
      - 4000:4000
    volumes:
      - ./:/app
      - ./fixtures/movies:/movies
      - ./fixtures/series:/series
    environment:
      - SETUP_ADMIN_EMAIL=admin@email.com
      - SETUP_ADMIN_NAME=admin
      - SETUP_ADMIN_PASSWORD=passwordpassword
      - RADARR_BASE_URL=http://radarr:7878
      - RADARR_API_KEY=d031e8c9b9df4b2fab311d1c3b3fa2c5
      - SONARR_BASE_URL=http://sonarr:8989
      - SONARR_API_KEY=1accda4476394bfcaddefe8c4fd77d4a
    command: bash -c "mix deps.get && mix ecto.migrate && mix run priv/repo/seeds.exs && mix phx.server"

  radarr:
    container_name: radarr
    image: linuxserver/radarr:version-4.1.0.6175
    ports:
      - 7878:7878
    volumes:
      - ./fixtures/radarr/config.xml:/config/config.xml
      - ./fixtures/radarr/root-folder.json:/config/root-folder.json
      - ./fixtures/radarr/movies.json:/config/movies.json
      - ./fixtures/movies:/movies
    environment:
      - PUID=0
      - PGID=0
    healthcheck:
      test: "exit 0"

  sonarr:
    container_name: sonarr
    image: linuxserver/sonarr:version-3.0.9.1549
    ports:
      - 8989:8989
    volumes:
      - ./fixtures/sonarr/config.xml:/config/config.xml
      - ./fixtures/sonarr/root-folder.json:/config/root-folder.json
      - ./fixtures/sonarr/series.json:/config/series.json
      - ./fixtures/series:/series
    environment:
      - PUID=0
      - PGID=0
    healthcheck:
      test: "exit 0"